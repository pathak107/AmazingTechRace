<%- include('./partials/header.ejs'); -%>

<section class="section center">
  <div class="container">
    <div class="row">
      <div class="col s12 m3">
        <p>Name: <%=user.name%></p>
      </div>
      <div class="col s12 m3">
        <p>Score: <%=user.score%></p>
      </div>
      <div class="col s12 m3">
        <p>Hints: <%=user.hints%></p>
      </div>
      <div class="col s12 m3">
        <p>Skips: <%=user.skips%></p>
      </div>

    </div>
    <h4><%= message %></h4>
    <br>
    <div class="row">
      <%if(games.length>0){%>
      <%for(var i=0; i< games.length; i++){%>
      <div class="col s12 m4">
        <div style="border-radius: 2rem;" class="game-card card-panel hover">
          <i class="material-icons large ">announcement</i>
          <h4><%= games[i].title %></h4>
          <p style="color: black;"><%= games[i].description %></p>
          <% for(var j=0;j< user.quesIndexInfo.length; j++){ %>
          <%if(user.quesIndexInfo[j].gameID==games[i]._id){%>
          <%if(user.quesIndexInfo[j].quesIndex < 7){%>
          <p style="color: black;"> <%=user.quesIndexInfo[j].quesIndex%>/30</p>
          <%}else{%>
          <p style="color: black;"> Solved.</p>
          <%}%>
                  <%}%>
          <%}%>
  
          <p id="timer<%=i%>" class="amber-text darken-3-text"></p>

          <p class="amber-text darken-3-text">Starts At: <%= new Date(games[i].startTime).toLocaleTimeString("en-US", {timeZone: "Asia/Kolkata"})%>
          <span>on <%=new Date(games[i].startTime).toLocaleDateString("en-US", {timeZone: "Asia/Kolkata"}) %></span>
          </p>
          <p class="amber-text darken-3-text">Ends At:
            <%= new Date(games[i].endTime).toLocaleTimeString("en-US", {timeZone: "Asia/Kolkata"})%> <span>on
              <%=new Date(games[i].endTime).toLocaleDateString("en-US", {timeZone: "Asia/Kolkata"}) %></span>
          </p>

          <a class="bttn" href="/game/start/<%= games[i]._id %>">Play Now</a>
        </div>

        <script>
          // Update the count down every 1 second
          setInterval(function () {

            // Get today's date and time
            var now = new Date().getTime();

            if (((new Date('<%=games[i].startTime%>').getTime()) - now) > 0) {
              document.getElementById("timer<%=i%>").innerHTML =
                `Starts in ${Math.floor((((new Date('<%=games[i].startTime%>').getTime()) - now) % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))} h
              ${Math.floor((((new Date('<%=games[i].startTime%>').getTime()) - now) % (1000 * 60 * 60)) / (1000 * 60))} m
               ${Math.floor((((new Date('<%=games[i].startTime%>').getTime()) - now) % (1000 * 60)) / 1000)} s`
            } 
            else {
              document.getElementById("timer<%=i%>").innerHTML =
                `Ends in ${Math.floor((((new Date('<%=games[i].endTime%>').getTime()) - now) % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))} h
              ${Math.floor((((new Date('<%=games[i].endTime%>').getTime()) - now) % (1000 * 60 * 60)) / (1000 * 60))} m
               ${Math.floor((((new Date('<%=games[i].endTime%>').getTime()) - now) % (1000 * 60)) / 1000)} s`
            }


            // If the count down is finished, write some text
            if ((new Date('<%=games[i].endTime%>').getTime()) - now < 0) {
              clearInterval(this.setInterval);
              document.getElementById("timer<%=i%>").innerHTML = "Closed";
            }
          }, 1000);
        </script>
      </div>
      <%}%>
        <%}else{%>
      <h5>There are no games at this moment.</h5>
      <%}%>
        
            
          </div>
        </div>
      </section>
    

      